<!DOCTYPE html>

<html> 
	<head> 
        <style>
            body {
                background-image: url("images/paw-3.jpg");
                background-position: 50% 50%;
                background-repeat: repeat;
            }
            .maintext {
                padding-top: 8%; 
                font-family: "Courier New", monospace; 
                font-weight: 600; 
                font-size: 8em; 
                color: #2ce8db; 
                text-align: center; 
                text-shadow: 1px 1px 2px black, 0 0 25px #218287, 0 0 5px #144760;
            }
            .container {
                border-radius: 8px;
                background-color: white;
                box-shadow: 1px 1px 2px black, 0 0 25px #218287, 0 0 5px #144760;
                padding: 20px;
                text-align: center; 
                font-family: "Courier New", monospace; 
                font-size: 2em; 
                margin-left: 35%; 
                margin-right: 35%; 
                margin-top: 4%; 
            }
            .errorMsg{
            font-weight: bold;
            font-size: 0.5em;
            color: red;
            }
            input[type=text],input[type=password]{
                box-sizing: border-box;
                box-shadow:  1px 1px 2px black, 0 0 25px #218287, 0 0 5px #144760;
                border: 1px solid #2ce8db;  
                padding: 10px 20px; 
                border-radius: 8px;
                outline: none;
            }

            a.link:link {color: black; background-color: transparent}
            a.link:visited {color: inherit}
            a.link:hover{color: #2ce8db}
        </style>
        
        <script src="scripts/hash.js"></script>
        <script src="scripts/json.js"></script>
        <script>
            var request;
            function login() {
                // part 1: process login info
                var uname = document.getElementById("uname").value;
                var password = document.getElementById("password").value;
                if (uname.length <= 1 || password.length < 8) {
                    document.getElementById("errormsg").innerHTML = "Username or password is too short.";
                    return false;
                }
                uname = uname.replace(/\s+/g, '');
                password = password.replace(/\s+/g, '');
                password = hash(password);

                // part 2: POST to server
                var a1 = ["uname", "password"];
                var a2 = [uname, password];
                var payload = formatAsJSON(a1, a2);
                request = new XMLHttpRequest();
                request.open("POST", 'login', true);
                request.addEventListener("readystatechange", requestReceived, false);
                request.send(payload);
                return false;
            }

            function requestReceived() {
                if (request.responseText != null) {
                    var data = JSON.parse(request.responseText);
                    if (data.status) {
                        document.getElementById("errormsg").innerHTML = "Login succesful.";
                        // go to main page
                    } else {
                        document.getElementById("errormsg").innerHTML = "Invalid username or password.";
                    }
                } else {
                    document.getElementById("errormsg").innerHTML = "Something went wrong. Try again later.";
                }
            }
        </script>
	</head> 
	
	<body>
		<div class="maintext">
			All Bark No Bite
		</div>
		
		<div class="container"> 
			Login
			</br>
            </br>
			<form onsubmit="return login()">
				<input type="text" id="uname" name="uname" placeholder="Username" style="font-family: Courier New, monospace; font-size: .75em">
				</br>
                </br>
				<input type="password" id="password" name="password" placeholder="Password" style="font-family: Courier New, monospace; font-size: .75em">
				</br>
                <span class="errorMsg" id="errormsg"></span>
                </br>
                <input type="submit" value="Submit" style="font-family: Courier New, monospace; font-size: .75em;">
                </br>
                </br>
			</form>
		</div> 

		<div style="font-family: Courier New, monospace; font-weight: 800; font-size: 1.5em; text-align: center; margin-top: 3%"> 
			Don't have an account? 
            <a class="link" href="ABNBSignUp.html" onclick=credentials()>Sign up</a>
		</div> 
	</body>
</html> 
